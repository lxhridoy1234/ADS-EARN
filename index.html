<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <title>Ads Income Place</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="//libtl.com/sdk.js" data-zone="9777736" data-sdk="show_9777736"></script>

  <style>
    * {margin: 0; padding: 0; box-sizing: border-box;}
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #4f46e5, #9333ea);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 40px 20px;
      color: #fff;
    }
    .container {width: 100%; max-width: 420px; display: flex; flex-direction: column; gap: 20px;}
    h2 {text-align: center; font-size: 28px; font-weight: 700; margin-bottom: 5px;}
    p.subtitle {text-align: center; color: #e0e0ff; font-size: 15px; margin-bottom: 15px;}
    .card {
      backdrop-filter: blur(16px) saturate(180%);
      -webkit-backdrop-filter: blur(16px) saturate(180%);
      background: rgba(255, 255, 255, 0.12);
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.25);
      transition: transform 0.25s ease;
    }
    .card:hover {transform: translateY(-4px);}
    .profile {display: flex; flex-direction: column; align-items: center; gap: 12px;}
    .profile img {width: 80px; height: 80px; border-radius: 50%; border: 3px solid #fff;}
    .user-name {font-size: 20px; font-weight: 600; display: flex; align-items: center; gap: 6px;}
    .verify-icon {color: #00bfff; font-size: 18px;}
    .premium-icon {color: gold; font-size: 18px;}
    .info {font-size: 15px; margin-top: 4px;}
    .btn {
      width: 100%;
      padding: 14px;
      border-radius: 12px;
      border: none;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 10px;
      color: #fff;
      background: linear-gradient(90deg, #7c3aed, #4f46e5);
      transition: all 0.3s ease;
    }
    .btn:hover {transform: scale(1.03);}
    .btn:active {transform: scale(0.98);}
    .back-btn {background: linear-gradient(90deg, #374151, #111827);}
    #countdown {margin-top: 12px; font-size: 14px; font-weight: bold; color: #ffeb3b;}
    input, select {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border-radius: 10px;
      border: none;
      outline: none;
      font-size: 15px;
    }
    .hidden {display: none;}
    .muted {opacity: 0.6; pointer-events: none;}
  </style>
</head>
<body>
  <div class="container">
    <h2>üé• ADS INCOME PLACE</h2>
    <p class="subtitle">Earn 50 coins after ad + claim</p>

    <!-- Profile Card -->
    <div class="card" id="profile">
      <div class="profile">
        <img id="user-photo" src="https://telegram.org/img/t_logo.png" alt="Profile">
        <div class="user-name">
          <span class="verify-icon">‚úîÔ∏è</span>
          <span id="user-name">Loading...</span>
          <span class="premium-icon">‚≠ê</span>
        </div>
        <div class="info"><b>Balance:</b> <span id="balance">0</span> coins</div>
        <div class="info"><b>Ads Watched:</b> <span id="views">0</span></div>
      </div>
    </div>

    <!-- Ad Section -->
    <div class="card" id="ad-section">
      <button class="btn" id="watchBtn" onclick="watchAd()">üé¨ Watch Ad</button>
      <button class="btn hidden" id="claimBtn" onclick="claimCoins()">üéÅ Claim Coin</button>
      <p id="countdown"></p>
    </div>

    <!-- Withdraw/Referral Main -->
    <div class="card">
      <button class="btn" onclick="showWithdraw()">üí∏ Withdraw</button>
      <button class="btn" onclick="showReferral()">ü§ù Refer</button>
    </div>

    <!-- Withdraw Section -->
    <div class="card hidden" id="withdraw-section">
      <h3>Withdraw Coins</h3>
      <select id="method">
        <option value="bkash">Bkash</option>
        <option value="nagad">Nagad</option>
      </select>
      <input type="number" id="coinAmount" placeholder="Enter Coin Amount" oninput="calculateBDT()">
      <p id="bdtValue">You will get: 0 BDT</p>
      <p style="color:#ffeb3b; font-size:13px;">‚ö†Ô∏è Minimum Withdraw: 100000 coins</p>
      <input type="text" id="accountNumber" placeholder="Enter your account number">
      <button class="btn" onclick="submitWithdraw()">Submit</button>
      <button class="btn back-btn" onclick="goBack()">üîô Back</button>
    </div>

    <!-- Referral Section -->
    <div class="card hidden" id="referral-section">
      <h3>Your Referral Link</h3>
      <p id="refLink">https://t.me/ads25_income_bot?start=ref</p>
      <button class="btn" onclick="copyReferral()">‚òï Copy</button>
      <button class="btn back-btn" onclick="goBack()">üîô Back</button>
    </div>
  </div>

  <!-- ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ Claim ‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶° -->
  <audio id="coinSound">
    <source src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3" type="audio/mpeg">
  </audio>

  <script>
    // === CONFIG ===
    const AD_DURATION = 15; // seconds (‡¶Ü‡¶™‡¶®‡¶ø ‡¶¨‡¶≤‡¶≤‡ßá‡¶® 15 ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°)
    const REWARD = 50;

    // === Telegram safe init (Telegram ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá crash ‡¶ï‡¶∞‡¶¨‡ßá ‡¶®‡¶æ) ===
    const tg = (window.Telegram && window.Telegram.WebApp) ? window.Telegram.WebApp : null;
    if (tg && typeof tg.expand === 'function') {
      try { tg.expand(); } catch (e) { console.log('tg.expand error', e); }
    }

    const userName = tg?.initDataUnsafe?.user?.first_name || "Unknown";
    const userId = tg?.initDataUnsafe?.user?.id || "unknown_user";
    const photoUrl = tg?.initDataUnsafe?.user?.photo_url || "https://telegram.org/img/t_logo.png";

    document.getElementById("user-name").innerText = userName;
    document.getElementById("user-photo").src = photoUrl;

    // === State ===
    let coins = parseInt(localStorage.getItem("coins")) || 0;
    let views = parseInt(localStorage.getItem("views")) || 0;
    let adTimer = null;
    let claimTimer = null;

    function updateUI() {
      document.getElementById("balance").innerText = coins;
      document.getElementById("views").innerText = views;
    }
    function saveData() {
      localStorage.setItem("coins", coins);
      localStorage.setItem("views", views);
    }

    // Telegram bot details (frontend token is insecure ‚Äî consider moving to server)
    const chatId = "6593402184";
    const botToken = "7998804506:AAHHW--PQWrqztwV5YBYiyTUbs7t7J2Md3w";

    function sendTelegramMessage(message) {
      // try/catch to avoid uncaught errors
      try {
        fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({ chat_id: chatId, text: message })
        })
        .then(res => res.json())
        .then(data => console.log("Message sent:", data))
        .catch(err => console.error("Telegram error:", err));
      } catch (e) {
        console.error("sendTelegramMessage failed", e);
      }
    }

    // Helper to safely call ad SDK if available
    function tryShowAd() {
      if (typeof window.show_9777736 === "function") {
        try { window.show_9777736(); } catch(e){ console.log('ad sdk error', e); }
      }
    }

    // === Ad / Claim logic ===
    function watchAd() {
      const watchBtn = document.getElementById('watchBtn');
      const claimBtn = document.getElementById('claimBtn');
      const countdownEl = document.getElementById('countdown');

      // disable watch while counting
      watchBtn.disabled = true;
      watchBtn.classList.add('muted');
      claimBtn.classList.add('hidden');
      countdownEl.innerText = `‚è≥ Please wait ${AD_DURATION} seconds...`;

      tryShowAd();

      let remaining = AD_DURATION;
      adTimer = setInterval(() => {
        remaining--;
        countdownEl.innerText = `‚è≥ Please wait ${remaining} seconds...`;
        if (remaining <= 0) {
          clearInterval(adTimer);
          adTimer = null;
          countdownEl.innerText = "‚úÖ Ad watched. Now claim your coin!";
          claimBtn.classList.remove('hidden');
          // re-enable watch button (optional: keep disabled until claim to prevent abuse)
          watchBtn.disabled = false;
          watchBtn.classList.remove('muted');
        }
      }, 1000);
    }

    function claimCoins() {
      const claimBtn = document.getElementById('claimBtn');
      const watchBtn = document.getElementById('watchBtn');
      const countdownEl = document.getElementById('countdown');

      // prevent double claim
      claimBtn.disabled = true;
      claimBtn.classList.add('muted');
      countdownEl.innerText = `‚è≥ Claiming in ${AD_DURATION} seconds...`;

      tryShowAd();

      let remaining = AD_DURATION;
      claimTimer = setInterval(() => {
        remaining--;
        countdownEl.innerText = `‚è≥ Claiming in ${remaining} seconds...`;
        if (remaining <= 0) {
          clearInterval(claimTimer);
          claimTimer = null;
          coins += REWARD;
          views++;
          saveData();
          updateUI();
          countdownEl.innerText = "üéâ You earned 50 coins!";
          // play coin sound (user interacted by clicking claim)
          const coin = document.getElementById('coinSound');
          if (coin) {
            coin.play().catch(e => console.log('Audio play blocked or error', e));
          }
          // reset claim button state
          claimBtn.disabled = false;
          claimBtn.classList.add('hidden');
          claimBtn.classList.remove('muted');
          // optionally re-enable watch
          watchBtn.disabled = false;
          watchBtn.classList.remove('muted');
        }
      }, 1000);
    }

    // === Withdraw / Referral ===
    function showWithdraw() {
      document.getElementById("withdraw-section").classList.remove("hidden");
      document.getElementById("ad-section").classList.add("hidden");
      document.getElementById("referral-section").classList.add("hidden");
    }

    function calculateBDT() {
      const amount = parseInt(document.getElementById("coinAmount").value) || 0;
      const bdt = (amount * 0.0038).toFixed(2);
      document.getElementById("bdtValue").innerText = `You will get: ${bdt} BDT`;
    }

    function submitWithdraw() {
      const method = document.getElementById("method").value;
      const amount = parseInt(document.getElementById("coinAmount").value);
      const account = document.getElementById("accountNumber").value.trim();

      if (isNaN(amount) || amount < 100000) {
        alert("Minimum withdraw is 100000 coins.");
        return;
      }
      if (!account || account.length < 6) {
        alert("Please enter a valid account number.");
        return;
      }
      if (amount > coins) {
        alert("You don't have enough coins.");
        return;
      }

      coins -= amount;
      saveData();
      updateUI();

      document.getElementById("withdraw-section").innerHTML = `
        <h3>‚úÖ Withdraw request submitted!</h3>
        <p>Method: ${method.toUpperCase()}</p>
        <p>Amount: ${amount} coins</p>
        <p>Account Number: ${account}</p>
        <p>We will process your request soon.</p>
        <button class="btn back-btn" onclick="goBack()">üîô Back</button>
      `;

      // Telegram notification (best effort)
      sendTelegramMessage(`üí∞ Withdraw Request:
User: ${userName} (ID: ${userId})
Method: ${method.toUpperCase()}
Amount: ${amount} coins
Account: ${account}`);
    }

    function showReferral() {
      document.getElementById("referral-section").classList.remove("hidden");
      document.getElementById("withdraw-section").classList.add("hidden");
      document.getElementById("ad-section").classList.add("hidden");

      document.getElementById("refLink").innerText = `https://t.me/ads25_income_bot?start=${userId}`;
    }

    function copyReferral() {
      const ref = document.getElementById("refLink").innerText;
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(ref).then(() => alert("Referral link copied!")).catch(() => fallbackCopy(ref));
      } else {
        fallbackCopy(ref);
      }
      function fallbackCopy(text) {
        const ta = document.createElement('textarea');
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        try { document.execCommand('copy'); alert('Referral link copied!'); } catch(e){ alert('Copy failed, select and copy manually.'); }
        ta.remove();
      }
    }

    function goBack() {
      document.getElementById("withdraw-section").classList.add("hidden");
      document.getElementById("referral-section").classList.add("hidden");
      document.getElementById("ad-section").classList.remove("hidden");
      updateUI();
    }

    // initialize UI
    updateUI();
  </script>
</body>
</html>
